<!DOCTYPE html><html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Portefeuille Crypto & Actions</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f4f4f4;
      margin: 0; padding: 20px;
      display: flex; flex-direction: column; align-items: center;
    }
    .controls, table, .opps {
      max-width: 600px;
      width: 100%;
      margin-bottom: 20px;
    }
    .controls input, .controls select, .controls button {
      padding: 10px; margin: 5px; width: calc(100% - 22px);
    }
    table { border-collapse: collapse; background: #fff; }
    th, td { padding: 10px; border: 1px solid #ddd; text-align: center; }
    th { background: #eee; }
    .gain { color: green; }
    .perte { color: red; }
  </style>
</head>
<body>
  <h1>Portefeuille</h1>
  <div class="controls">
    <select id="type">
      <option value="crypto">Crypto</option>
      <option value="action">Action</option>
    </select>
    <input id="symbol" placeholder="Symbole (ex: bitcoin, AAPL)" />
    <input id="quantity" type="number" placeholder="Quantité" />
    <input id="invested" type="number" placeholder="Investi (CAD)" />
    <button onclick="addAsset()">Ajouter</button>
    <button onclick="refreshAll()">Actualiser maintenant</button>
  </div>  <table>
    <thead>
      <tr><th>Type</th><th>Symbole</th><th>Qté</th><th>Investi</th><th>Prix</th><th>Valeur</th><th>Var. 24h</th></tr>
    </thead>
    <tbody id="portfolio"></tbody>
  </table>  <div class="opps">
    <h2>Opportunités du moment</h2>
    <ul id="opportunityList"></ul>
  </div>  <script>
    const ALPHA_KEY = 'W9V75CXC1GIZ3HFX';
    const portfolio = [
  { type: 'action', sym: 'AAPL', qty: 1.2, inv: 300, price: 0, change: 0 },
  { type: 'action', sym: 'TSLA', qty: 0.8, inv: 250, price: 0, change: 0 },
  { type: 'crypto', sym: 'bitcoin', qty: 0.02, inv: 800, price: 0, change: 0 },
  { type: 'crypto', sym: 'ethereum', qty: 0.1, inv: 350, price: 0, change: 0 }
];

    async function fetchCryptoPrice(symbol) {
      const url = `https://api.coingecko.com/api/v3/simple/price?ids=${symbol}&vs_currencies=cad&include_24hr_change=true`;
      try {
        const res = await fetch(url);
        const data = await res.json();
        return data[symbol] ? { price: data[symbol].cad, change: data[symbol].cad_24h_change } : null;
      } catch { return null; }
    }

    async function fetchActionPrice(symbol) {
      const url = `https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=${symbol}&apikey=${ALPHA_KEY}`;
      try {
        const res = await fetch(url);
        const data = await res.json();
        const quote = data['Global Quote'];
        const price = parseFloat(quote['05. price']);
        const change = parseFloat(quote['10. change percent']);
        return { price, change };
      } catch { return null; }
    }

    async function addAsset() {
      const type = document.getElementById('type').value;
      const sym = document.getElementById('symbol').value.trim().toLowerCase();
      const qty = parseFloat(document.getElementById('quantity').value);
      const inv = parseFloat(document.getElementById('invested').value);
      if (!sym || !qty || !inv) return alert('Tous les champs sont requis.');

      let data;
      if (type === 'crypto') data = await fetchCryptoPrice(sym);
      else data = await fetchActionPrice(sym.toUpperCase());

      if (!data || !data.price) return alert('Erreur récupération prix.');

      portfolio.push({ type, sym, qty, inv, price: data.price, change: data.change });
      display();
    }

    async function display() {
  const tbody = document.getElementById('portfolio');
  tbody.innerHTML = '';
  for (const a of portfolio) {
    if (a.type === 'crypto') {
      const data = await fetchCryptoPrice(a.sym);
      if (data) { a.price = data.price; a.change = data.change; }
    } else {
      const data = await fetchActionPrice(a.sym);
      if (data) { a.price = data.price; a.change = data.change; }
    }
    const val = (a.price * a.qty).toFixed(2);
    const changeClass = a.change >= 0 ? 'gain' : 'perte';
    tbody.innerHTML += `<tr><td>${a.type}</td><td>${a.sym.toUpperCase()}</td><td>${a.qty}</td><td>${a.inv.toFixed(2)}</td><td>${a.price.toFixed(2)}</td><td>${val}</td><td class="${changeClass}">${a.change.toFixed(2)}%</td></tr>`;
  }
}</td><td>${a.sym.toUpperCase()}</td><td>${a.qty}</td><td>${a.inv.toFixed(2)}</td><td>${a.price.toFixed(2)}</td><td>${val}</td><td class="${changeClass}">${a.change.toFixed(2)}%</td></tr>`;
      });
    }

    async function fetchOpportunities() {
      const url = 'https://api.coingecko.com/api/v3/coins/markets?vs_currency=cad&order=price_change_percentage_24h_desc&per_page=10&page=1&sparkline=false';
      const list = document.getElementById('opportunityList');
      list.innerHTML = '';
      try {
        const res = await fetch(url);
        const data = await res.json();
        data.forEach(c => {
          const p = c.price_change_percentage_24h;
          const item = document.createElement('li');
          item.textContent = `${c.name} (${c.symbol.toUpperCase()}) : +${p.toFixed(2)}%`; 
          list.appendChild(item);
        });
      } catch {
        list.innerHTML = '<li>Erreur chargement opportunités.</li>';
      }
    }

    async function refreshAll() {
      display();
      fetchOpportunities();
    }

    refreshAll();
  </script></body>
</html>
